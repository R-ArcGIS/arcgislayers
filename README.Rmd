---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(pillar)
```

# arcgislayers <img src="man/figures/logo.svg" align="right" height="139" alt="" />

<!-- badges: start -->

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/license/apache-2-0)
[![R-CMD-check](https://github.com/R-ArcGIS/arcgislayers/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/R-ArcGIS/arcgislayers/actions/workflows/R-CMD-check.yaml)
[![Lifecycle: stable](https://img.shields.io/badge/lifecycle-stable-brightgreen.svg)](https://lifecycle.r-lib.org/articles/stages.html#stable)
[![](https://cranlogs.r-pkg.org/badges/arcgislayers)](https://cran.r-project.org/package=arcgislayers)
<!-- badges: end -->


`{arcgislayers}` is the core data access package in the R-ArcGIS Bridge, providing a unified interface for working with ArcGIS data services. As part of the `{arcgis}` metapackage, it enables seamless integration between R and the ArcGIS Web GIS ecosystem, including ArcGIS Online, Enterprise, and Location Platform.


## Capabilities

- **Connect to any ArcGIS Data Service**: Access feature services, imagery, and portal items from ArcGIS Online, Enterprise and Location Platform using familiar R objects from `sf` and `terra`. 
- **Publish your R objects**: Turn analysis outputs into live ArcGIS services that others can access, visualize, modify, and use in their workflows.
- **Modify data in place**: Maintain your production datasets—update, add, or delete features in feature services directly from R.
- **Attachments**: query, download, and update attachments in feature services created by Survey123.


## Installation

`{arcgislayers}` is part of the `{arcgis}` metapackage, which provides the complete R-ArcGIS Bridge toolkit. For most users, installing the metapackage is recommended:

```r
install.packages("arcgis")
```

You can also install `{arcgislayers}` individually from CRAN:

```r
install.packages("arcgislayers")
```

To install the development version:

```r
pak::pak("r-arcgis/arcgislayers")
```

## Usage

The basic workflow is: **connect** ➡️ **query** ➡️ **analyze** ➡️ **publish**. Here's how to get started: 

```{r}
library(arcgis)
```


### Connect to ArcGIS Data Services

`arc_open()` connects to any ArcGIS data service using its URL or item ID. This creates a connection to the remote data without downloading anything yet.

```{r}
# Connect to a feature service
furl <- "https://services.arcgis.com/P3ePLMYs2RVChkJx/ArcGIS/rest/services/USA_Counties_Generalized_Boundaries/FeatureServer/0"

county_fl <- arc_open(furl)
county_fl
```

### Query Data

`arc_select()` brings data from ArcGIS into R as familiar `sf` objects. You can get everything, or be selective:

```{r}
# Get all data (use with caution on large datasets!)
counties_all <- arc_select(county_fl)

# Get specific columns and rows
large_counties <- arc_select(
  county_fl,
  fields = c("state_abbr", "population"),
  where = "population > 1000000"
)

large_counties
```

### Spatial and Attribute Filtering

Filter by location or attributes before bringing data into R:

```{r}
# Spatial filter: get counties that intersect with North Carolina
nc <- sf::st_read(system.file("shape/nc.shp", package="sf"))

nc_area_counties <- arc_select(
  county_fl,
  filter_geom = sf::st_bbox(nc[1,])
)

nc_area_counties
```

Use `list_fields()` to explore available attributes:

```{r}
list_fields(county_fl)
```

### Work with Imagery

`arc_raster()` extracts raster data from ArcGIS ImageServers as `terra` objects:

```{r}
# Connect to Landsat imagery
img_url <- "https://landsat2.arcgis.com/arcgis/rest/services/Landsat/MS/ImageServer"
landsat <- arc_open(img_url)

# Extract imagery for a specific area
res <- arc_raster(
  landsat, 
  xmin = -71, 
  ymin = 43, 
  xmax = -67, 
  ymax = 47.5, 
  bbox_crs = 4326, 
  width = 500,
  height = 500
)

terra::plot(res)
```

### Publish Your Results

Turn your R analysis into ArcGIS services that others can access:

```{r eval=FALSE}
# Publish an sf object as a feature service (requires authentication)
my_analysis <- large_counties |>
  dplyr::mutate(density_category = ifelse(pop_sqmi > 100, "Dense", "Sparse"))

publish_layer(
  my_analysis,
  title = "County Population Density Analysis",
  description = "Counties categorized by population density"
)
```

## Learn more

To learn more about about how to most effectively use `{arcgislayers}` for your use case review the [developer site documentation](https://developers.arcgis.com/r-bridge).

- [Authentication](https://developers.arcgis.com/r-bridge/authentication/)
- [Publishing Layers](https://developers.arcgis.com/r-bridge/layers/publishing/)
- [Editing Feature Services](https://developers.arcgis.com/r-bridge/editing/editing-overview/)
- [Geocoding](https://developers.arcgis.com/r-bridge/geocoding/overview/)