<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="arcgislayers">
<title>Authorization • arcgislayers</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Authorization">
<meta property="og:description" content="arcgislayers">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">arcgislayers</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Authorization.html">Authorization</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Authorization</h1>
            
      
      
      <div class="d-none name"><code>Authorization.Rmd</code></div>
    </div>

    
    
<p>Authorization is required for users who wish to access data that is
in a non-public ArGIS Online (AGOL) organization, in an ArcGIS
Enterprise portal, or wish to upload data to or modify data in AGOL.</p>
<p><a href="https://developers.arcgis.com/documentation/mapping-apis-and-services/security/oauth-2.0/" class="external-link">Authorization
is done using OAuth2</a>. There are two ways to authenticate with
OAuth2: either by using a a <code>code</code> or a <code>client</code>
flow. The recommendation for most people is to utilize code based
authentication.</p>
<p><strong>Note</strong>: users of <code>arcgisbinding</code> can use
<code>auth_binding()</code> to utilize the tokens that result from
<code>arc.check_portal()</code>.</p>
<blockquote>
<p>Tip: use client based authorization for non-interactive work.</p>
</blockquote>
<div class="section level2">
<h2 id="code-based-authorization">Code based authorization<a class="anchor" aria-label="anchor" href="#code-based-authorization"></a>
</h2>
<p>To use code based authorization use the <code>auth_code()</code>
function. This requires a client ID. A <a href="https://www.oauth.com/oauth2-servers/client-registration/client-id-secret" class="external-link">client
ID</a> is a public identifier to an application that you will
authenticate against. This is the <strong>only</strong> method of
authorization that provides you with a refresh token.</p>
<div class="section level3">
<h3 id="getting-the-client-id">Getting the Client ID<a class="anchor" aria-label="anchor" href="#getting-the-client-id"></a>
</h3>
<p>A client ID would likely be provided by an admin of an AGOL
organization or ArcGIS Enterprise. In the case that you don’t have one
you can more than likely create one. To create a client application log
into your portal and create a new item.</p>
<p>Create a new <code>Developer credentials</code></p>
<p><img src="images/create-item.png"></p>
<p><strong>Ensure the redirect URL is
<code>urn:ietf:wg:oauth:2.0:oob</code></strong> and keep the other
default selections. Press next and fill out additional fields.</p>
<p><img src="images/item-summary.png"></p>
<p>You will be redirected to the content page. You will see credentials
for your application. <strong>Do not share these</strong>. <img src="images/oauth-app.png"></p>
<p>By default environment variables will be used by
<code>auth_code()</code>. To edit your environment variables with your
newly created credentials use <code>usethis::edit_r_environ()</code>
which will open an <code>.Renviron</code> file for you.</p>
<blockquote>
<p>User level environment variables will be used by default. If you want
to use a project level <code>.Renviron</code> file use
<code>usethis::edit_r_environ("project")</code>.</p>
</blockquote>
<p>Add the following lines to your <code>.Renviron</code> file.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="va">ARCGIS_CLIENT</span><span class="op">=</span>your-client-id</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">ARCGIS_SECRET</span><span class="op">=</span>your-super-secret-key</span></code></pre></div>
<blockquote>
<p>The <code>ARCGIS_SECRET</code> environment variable will only be used
in <code>auth_client()</code> and not necessary for
<code>auth_code()</code>.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="authorizing">Authorizing<a class="anchor" aria-label="anchor" href="#authorizing"></a>
</h3>
<p>First, load the library.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">arcgis</span><span class="op">)</span></span></code></pre></div>
<p>Next run <code>auth_code()</code> which will open a tab in your
browser. If you are authorizing to somewhere other than AGOL, set the
<code>host</code>
argument—e.g. <code>auth_code(host = "https://portal.my-company.com")</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu">auth_code</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You will be prompted to sign in to your portal.</p>
<p><img src="images/oauth-sign-in.png" style="width:50.0%"></p>
<p>Once you’ve signed in, copy the code that appears, and return to R.
Enter the code into the console without any modifications and press
enter.</p>
<p><img src="images/oauth-code.png" style="width:70.0%"></p>
<p>Your authorization will have completed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">token</span></span>
<span><span class="co">#&gt; &lt;httr2_token&gt;</span></span>
<span><span class="co">#&gt; token_type: bearer</span></span>
<span><span class="co">#&gt; access_token: &lt;REDACTED&gt;</span></span>
<span><span class="co">#&gt; expires_at: 2023-03-03 13:21:40</span></span>
<span><span class="co">#&gt; refresh_token: &lt;REDACTED&gt;</span></span>
<span><span class="co">#&gt; username: your-user</span></span>
<span><span class="co">#&gt; ssl: TRUE</span></span>
<span><span class="co">#&gt; refresh_token_expires_in: 1209599</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="refreshing-tokens">Refreshing tokens<a class="anchor" aria-label="anchor" href="#refreshing-tokens"></a>
</h3>
<p><code>auth_code()</code> tokens can be refreshed. These tokens come
with a refresh token that can be exchanged for a new token. This can be
done with <code>refresh_token()</code>. It requires the original token,
client ID, and hostname (which is <a href="https://arcgis.com" class="external-link uri">https://arcgis.com</a> by default).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">refresh_token</span><span class="op">(</span><span class="va">token</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;httr2_token&gt;</span></span>
<span><span class="co">#&gt; token_type: bearer</span></span>
<span><span class="co">#&gt; access_token: &lt;REDACTED&gt;</span></span>
<span><span class="co">#&gt; expires_at: 2023-03-03 15:52:13</span></span>
<span><span class="co">#&gt; username: user-name</span></span>
<span><span class="co">#&gt; ssl: TRUE</span></span>
<span><span class="co">#&gt; refresh_token: &lt;REDACTED&gt;</span></span></code></pre></div>
<p>Additionally the function <code>validate_or_refresh_token()</code> is
provided. This can be useful if you have a very long running job that
may exceed your token’s validity. If your token is a expired, it will be
refreshed. If it is not expired, and <em>will not</em> expire within the
<code>refresh_threshold</code>, it will be returned.</p>
</div>
</div>
<div class="section level2">
<h2 id="client-authorization">Client authorization<a class="anchor" aria-label="anchor" href="#client-authorization"></a>
</h2>
<p>For non-interactive workflows a client OAuth2 flow is more
appropriate. This approach does not require you to copy and paste a code
from the browser into your R session. This method does not generate a
refresh token, though.</p>
<p>Use <code>auth_client()</code> to perform client based authorization.
<code>auth_client()</code> has a <code>secret</code> argument which, by
default, uses the environment variable <code>ARCGIS_SECRET</code> which
was set in your <code>.Renviron</code> file above. Running</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">auth_client</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;httr2_token&gt;</span></span>
<span><span class="co">#&gt; token_type: bearer</span></span>
<span><span class="co">#&gt; access_token: &lt;REDACTED&gt;</span></span>
<span><span class="co">#&gt; expires_at: 2023-03-03 17:12:48</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="legacy-password-authorization">Legacy Password authorization<a class="anchor" aria-label="anchor" href="#legacy-password-authorization"></a>
</h2>
<p>If you find yourself on a legacy system that requires username and
password authorization, you can accomplish this with
<code>auth_password()</code>. While this method of authorization is not
recommended, it is still possible.</p>
<p><code>auth_user()</code> has the arguments <code>username</code> and
<code>password</code> which, by default, use the <code>.Renviron</code>
environment variables <code>ARCGIS_USER</code> and
<code>ARCGIS_PASSWORD</code>. It is <em>strongly</em> recommended that
you use environment variables and never store your credentials in plain
text in your scripts.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">auth_user</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;httr2_token&gt;</span></span>
<span><span class="co">#&gt; token_type: bearer</span></span>
<span><span class="co">#&gt; access_token: &lt;REDACTED&gt;</span></span>
<span><span class="co">#&gt; expires_at: 2023-03-03 15:18:21</span></span></code></pre></div>
<!-- https://developers.arcgis.com/rest/users-groups-and-items/authentication.htm -->
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Josiah Parry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
