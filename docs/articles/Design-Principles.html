<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="arcgis">
<title>Design Principles • arcgis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design Principles">
<meta property="og:description" content="arcgis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">arcgis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Authorization.html">Authorization</a>
    <a class="dropdown-item" href="../articles/Design-Principles.html">Design Principles</a>
    <a class="dropdown-item" href="../articles/python-comparison.html">Comparison with ArcGIS Python API</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Design Principles</h1>
            
      
      
      <div class="d-none name"><code>Design-Principles.Rmd</code></div>
    </div>

    
    
<p>The immediate goal of <code>arcgis</code> is to provide an interface
to ArcGIS Online and Enterprise enabling the download of data.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="r-object-representation">R object representation<a class="anchor" aria-label="anchor" href="#r-object-representation"></a>
</h3>
<p>ArcGIS REST API provides access to 3 main types of GIS data: tables,
feature layers, and image layers. In R these are represented by
<code>data.frame</code> and <code>tibble</code> objects, <code>sf</code>
objects, and <code>SpatRaster</code> objects respectively.</p>
<div class="section level4">
<h4 id="tables">Tables<a class="anchor" aria-label="anchor" href="#tables"></a>
</h4>
<p>R is one of the first and only languages to have built in support for
data frame structures. Data frames are rectangular structures that
represent a table-like dataset (think of a database or excel table).
Data frames are composed of columns, all of equal length. Each column is
a vector (a one dimensional data set) of the same type—fundamental types
being integer, numeric, character, and logical.</p>
<p>When using R the preeminent tool to work with data frames is called
<code>dplyr</code> (data pliers) which is intended to work with an
extension of the data frame called tibbles. Tibbles are type safe(ish)
and far more strict (and prettier) than the base R
<code>data.frame</code>.</p>
</div>
<div class="section level4">
<h4 id="vector-data">Vector Data<a class="anchor" aria-label="anchor" href="#vector-data"></a>
</h4>
<p>The <code>sf</code> package in R was entirely transformative for the
way that spatial analysis was conducted in R and reduced the barrier to
entry for many (including myself). “sf” stands for simple features. The
package is based off of the simple feature standard which are
represented by the well-known text (WKT) standard.</p>
<blockquote>
<p><a href="https://www.ogc.org/standards/sfa" class="external-link">Read the standard
here.</a></p>
</blockquote>
<p>The most basic unit in sf is an <code>sfg</code> class object (simple
feature geometry).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note that wrapping an assignment in parens also prints it</span></span>
<span><span class="op">(</span><span class="va">pnt</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pnt</span><span class="op">)</span></span></code></pre></div>
<p>When we have more than one feature, it is stored in a simple feature
collection (sfc).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pnts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pnts</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pnts</span><span class="op">)</span></span></code></pre></div>
<p>sfc classes are further delineated into POINT, MULTIPOINT, POLYGON,
MULTIPOLYGON, LINESTRING, MULTILINESTRING, and the catch all GEOMETRY
which is used when there is more than one type of simple feature. Note
the class is <code>sfc_{TYPE}</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># illustrate catch all geometry.</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<p>The real power of sf is from it’s ability to be utilized in
conjunction with data frames and thus tools that manipulate them. The
<code>sf</code> class object is a data frame with an sfc column
associated with it.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read an sf object </span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nc</span></span></code></pre></div>
<p>Note the extra information that it prints before it prints the data
frame. This is a sign that it is explicitly spatial.</p>
<p>The big benefit, as stated, is that they can work with existing tools
like dplyr and even ggplot.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">nc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prop_sids <span class="op">=</span> <span class="va">SID74</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">SID74</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">prop_sids</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="raster-data">Raster Data<a class="anchor" aria-label="anchor" href="#raster-data"></a>
</h4>
<p>I am admitedly not very comfortable with raster data and even less so
in R. I do keep up with the times and pay attention, however. And I do
know that the package <a href="https://rspatial.github.io/terra/index.html" class="external-link"><code>terra</code></a>
is the new kid on the block and is being used to phase out the older
<code>raster</code> package (a transition is currently underway in the
wider rspatial and r-spatial communities—different, annoying, I
know).</p>
<p>There is also the possibility of using the package <a href="https://github.com/r-spatial/stars/" class="external-link">stars</a> which is for
“spatio-temporal arrays and raster cubes.” Which feels like it’s trying
to do too much all at once. It can read NetCDF files and raster images
and other things.</p>
<p>I think stars should be reserved for special cases.</p>
<p>This is definitely something I should learn more about.</p>
<p><a href="https://geocompr.robinlovelace.net/spatial-class.html#raster-data" class="external-link">Geocomputation
with R</a> talks about the difference between the two a bit.</p>
<p><a href="https://tmieno2.github.io/R-as-GIS-for-Economists/raster-basics.html#terra-package-spatraster" class="external-link">R
as GIS for Economists</a> mentions using terra and also using <a href="https://tmieno2.github.io/R-as-GIS-for-Economists/stars-basics.html" class="external-link">stars
for spatial temporal rasters</a></p>
<p>So one of those two should do it.</p>
</div>
</div>
<div class="section level3">
<h3 id="lazy-evaluation-and-dbplyr">Lazy evaluation and <code>dbplyr</code><a class="anchor" aria-label="anchor" href="#lazy-evaluation-and-dbplyr"></a>
</h3>
<p>First, to define lazy evaluation. It is the delaying of computing
until the very last moment. Computation is only carried out when a value
is needed or when told explicitly.</p>
<p><a href="https://dbplyr.tidyverse.org/" class="external-link"><code>dbplyr</code></a> is an
R package built upon the packages dplpyr and DBI (database interface).
DBI creates database connections. And dbplyr allows you to write dplyr
code that is then translated into SQL code and lazily evaluated.</p>
<p>dbplyr is amazing for quite a few reasons. First, it allows you to
use the same syntax that you would use for normal data frame
manipulation on a database. Meaning that dplyr becomes a front end that
is consistent and doesn’t care about the back end. So, one could, in
theory (and in practice—I’ve done it) write code on a CSV file to
prototype code and then change the source to a database and the same
code will funciton.</p>
<p>Second, dbplyr is amazing because it is lazy. You can write all the
dplyr code you want, but nothing actually is happening behind the scenes
other than building up the query that will be eventually computed by the
database. This means that you can do the vast majority of your
computation up front in the database and take the lift off of your
machine. This is a standard practice for speeding up production code at
the enterprise level.</p>
<p>Third, with dbplyr you control when a query is executed by running
the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> function.</p>
<p>Let’s look at an example. Take the <code>mtcars</code> data set. We
can group by the <code>cyl</code> column and compute the average
<code>mpg</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This is using basic dplyr code.</p>
<p>Now, we can create a fake database back end to use dbplyr. This
example is taken <a href="https://dbi.r-dbi.org/" class="external-link">from the DBI
documentation</a>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an ephemeral in-memory RSQLite database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, dbname <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to the connection</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mtcars"</span>, <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<p>We create a reference to the table using our connection.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mtcars"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cars</span></span></code></pre></div>
<p>Notice that the source is a
<code>table&lt;mtcars&gt; [?? x 11]</code>. The <code>??</code> is very
telling in that it doesn’t know how many there are because the
computation hasn’t happened.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mpg_query</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mpg</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since we assigned this to an object no computation has happened yet.
If we print it we request the value of the object so it is computed. At
this moment it is just a <em>promise</em>. It promises that it will give
us the value if we ask for it. Right now we can show the query that has
been generated for us.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">show_query</a></span><span class="op">(</span><span class="va">mpg_query</span><span class="op">)</span></span></code></pre></div>
<p>To trigger computation there are two things we can do:</p>
<ol style="list-style-type: decimal">
<li>run <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code> which will run the query inside the
database or</li>
<li>use <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> which will run the query inside the
database <strong>and</strong> return the result as an R native
object.</li>
</ol>
<p>Compare the two:</p>
<p>Compute it inside of the database (check the source)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span><span class="va">mpg_query</span><span class="op">)</span></span></code></pre></div>
<p>Collect it into memory (source no longer there)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="va">mpg_query</span><span class="op">)</span></span></code></pre></div>
<p>With all of that said, I think we can continue to my thinking of
design a bit more.</p>
</div>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<p>Since I’m really familiar with vector data and that’s what I care
about most, I figured we can start here.</p>
<p>All vector data is represented in AGOL as a feature layer whereas
non-spatial data is represented as a Table. These are represented by the
<code>FeatureLayer</code> and <code>Table</code> classes respectively.
The goal is to take inspiration from dbplyr. Each of these classes
contains the metadata associated with it but not the data. Since feature
layers and tables support querying, we want to make them lazy where we
allow the user to define their filters and selections in advance so that
the ArcGIS API can do the computation for them.</p>
<p>In this case the ArcGIS REST API is the database back-end. The
<code>FeatureLayer</code> and <code>Table</code> class objects are like
our remote tables that we can work with to define the computation needed
by the back-end and then bring information into R only as necessary.</p>
<div class="section level3">
<h3 id="query-capabilities">Query capabilities<a class="anchor" aria-label="anchor" href="#query-capabilities"></a>
</h3>
<p>Feature Layers and Tables both support querying which is the way to
extract information out of the API and into memory. The queries permit a
<code>where</code> parameter which is super basic SQL. Users can use
dplyr select and filter functions to build up the query that they
want.</p>
<p>Let’s take an example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">arcgis</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tbl_url</span> <span class="op">&lt;-</span> <span class="st">"https://services2.arcgis.com/j80Jz20at6Bi0thr/ArcGIS/rest/services/List_of_Providers/FeatureServer/27"</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/feature_table.html">feature_table</a></span><span class="op">(</span><span class="va">tbl_url</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span></span></code></pre></div>
<p>This is a table object. It is a list with all of it’s metadata and a
fancy print method. We can see the list by running
<code>unclass(tbl)</code> or <code>str(tbl)</code>. It’s a whole
lot.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># str(tbl)</span></span></code></pre></div>
<p>Using the power of <code>dbplyr</code> we can use select and filter
functions on tbl.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_select</span> <span class="op">&lt;-</span> <span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">OBJECTID</span>, <span class="va">Adoption_Service_Provider</span>, <span class="va">state</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Accredit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_select</span></span></code></pre></div>
<p>Now the fields of the query are being printed below. Since we are
using dbplyr under the hood we can use the tidyselect helper functions
to select certain columns based on strings or other helpful
selectors.</p>
<p>This is still a <code>Table</code> object that can be used to further
build up our query.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_filter</span> <span class="op">&lt;-</span> <span class="va">tbl_select</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"Wisconsin"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_filter</span></span></code></pre></div>
<p>This now has two parameters in the query populated
<code>outFields</code> and <code>where</code>. Since this is actually
just a list object, you can extract these parameters by grabbing the
<code>query</code> attribute of the underlying object.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">tbl_filter</span>, <span class="st">"query"</span><span class="op">)</span></span></code></pre></div>
<p>When we run <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> these are fed into the http
request and sent to ArcGIS to determine what is brought back into the
session.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wisconsin_providers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="va">tbl_filter</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wisconsin_providers</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-grand-vision">The Grand Vision™<a class="anchor" aria-label="anchor" href="#the-grand-vision"></a>
</h2>
<p>My idea here is that we can create objects for each representation in
the ArcGIS API that look nice, store metadata, and are lazy.</p>
<p>A Feature Server is simply a list with metadata that we can use to
determine which Feature Layers we want. Say we fetch a feature layer, it
is also just metadata with a pretty print method that we can use to
bring data into memory with if we so need! By being lazy about
everything we keep the computation small and thus very fast!</p>
<p>Here we have a Feature Server</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft_srv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/feature_server.html">feature_server</a></span><span class="op">(</span><span class="st">"https://services2.arcgis.com/j80Jz20at6Bi0thr/ArcGIS/rest/services/List_of_Providers/FeatureServer/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ft_srv</span></span></code></pre></div>
<p>We know something about it, but we don’t have all of the data (which
is good!). We can get a feature by it’s ID.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_layer.html">get_layer</a></span><span class="op">(</span><span class="va">ft_srv</span>, <span class="fl">24</span><span class="op">)</span></span></code></pre></div>
<p>That’s the gist of my vision thus far with ideas towards the future
of imagery</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/image_server.html">image_server</a></span><span class="op">(</span><span class="st">"https://landsat2.arcgis.com/arcgis/rest/services/Landsat/MS/ImageServer"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Josiah Parry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
