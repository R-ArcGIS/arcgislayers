<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ArcGIS R API direction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="2023-05-22_files/libs/clipboard/clipboard.min.js"></script>
<script src="2023-05-22_files/libs/quarto-html/quarto.js"></script>
<script src="2023-05-22_files/libs/quarto-html/popper.min.js"></script>
<script src="2023-05-22_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2023-05-22_files/libs/quarto-html/anchor.min.js"></script>
<link href="2023-05-22_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2023-05-22_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2023-05-22_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2023-05-22_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2023-05-22_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ArcGIS R API direction</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>May 22nd, 2023</p>
<p>Recently discussed R API with Lauren and there are a few key take-aways.</p>
<ul>
<li>Clean up user stories
<ul>
<li>notably that mentioning {arcgisbinding}’s ability to read remote services make the story muddy</li>
<li>Focus on capabilities more than user stories</li>
</ul></li>
<li>Initial release should support read at minimum and ideally write / update if feasible
<ul>
<li>can do incremental release at our own page with dev version on GitHub</li>
</ul></li>
<li>Should be on developer page as <code>ArcGIS API for R</code> or something similar</li>
</ul>
<hr>
<p>My thoughts:</p>
<section id="path-forward-for-arcgis-api-for-r" class="level2">
<h2 class="anchored" data-anchor-id="path-forward-for-arcgis-api-for-r">Path forward for ArcGIS API for R</h2>
<p>⁄We work towards an R metapackage like tidyverse or tidymodels. The metapackage will be called <code>arcgis</code> it will be composed of small R packages each with a specific purpose.</p>
<p>The first will support portal I/O and will cover only Feature Service, Image Server, and Map Severs–no tile support. Perhaps we call this <code>arcgisio</code>.</p>
<p>When <code>arcgis</code> is installed, <code>arcgisio</code> will be installed. Calling <code>library(arcgis)</code> will load <code>arcgisio</code>. The next package can be <code>arcgisrouting</code> which will do, you guessed it, routing. When we release that it will be incorporated into <code>arcgis</code>.</p>
</section>
<section id="future-of-r-arcgis-bridge" class="level2">
<h2 class="anchored" data-anchor-id="future-of-r-arcgis-bridge">Future of R-ArcGIS Bridge</h2>
<p>I personally like Dima’s definition. The bridge is anything that make ArcGIS and R work together. Right now this is <em>only</em> <code>arcgisbinding</code>.. Right now “R-ArcGIS Bridge” refers to the R package arcgisbinding and the capability of ArcGIS to have an embedded R executor.</p>
<p>There are three possible ways I see us handling this:</p>
<ul>
<li>When we release the <code>arcgis</code> R package I think this should be part of the “R-ArcGIS bridge”</li>
<li>If we don’t, then we make it very clear that the R-ArcGIS bridge is the ability to call R from ArcGIS and thus create GP tools using R scripts.
<ul>
<li>We then be very clear that {arcgisbinding} is the R package that can be used from R to interact with ArcGIS Pro.</li>
</ul></li>
<li>We refuse to acknowledge <code>arcgisbinding</code> as an R package distinct from the bridge and refuse to incorporate <code>arcgis</code> into the R-ArcGIS bridge umbrella. If so, it’s in our best interest to rename the R package from <code>arcgisbinding</code> to <code>rarcgisbridge</code> so our story is clear.</li>
</ul>
</section>
<section id="additional-development-tasks-we-should-endeavor" class="level2">
<h2 class="anchored" data-anchor-id="additional-development-tasks-we-should-endeavor">Additional development tasks we should endeavor</h2>
<ul>
<li><p>Embedded R GP script tools in ArcGIS pro</p></li>
<li><p>an R package to create ArcGIS Toolboxes from code. Notably this would mean that the R scripts we write define the argument names and types. Currently this is done manually. <strong>Prototype exists today</strong>.</p></li>
</ul>
<hr>
<p>The R-ArcGIS Bridge was announced almost 8 years ago at the 2015 Esri User Conference. It was the <a href="https://www.esri.com/about/newsroom/arcuser/10-takeaways-from-the-2015-esri-user-conference/">3rd highlight</a> of the conference.</p>
<blockquote class="blockquote">
<p>“This project is about helping the ArcGIS and R users become more successful in combining these technologies…” Steve Kopp</p>
</blockquote>
<p>The R-ArcGIS bridge at release consisted of a single R package called {arcgisbinding}. The R package, most notably, enabled R developers to create custom Geoprocessing Script tools using R as well as a way to read and write to local data sources in ArcGIS Pro directly from R. The R package and R-ArcGIS bridge have become synonymous.</p>
<p>Since 2015 the ArcGIS Ecosystem has grown considerably and so has the R ecosystem has grown exponentially. As our product offerings and the capabilities of the R langauge have grown the R-ArcGIS Bridge has not reflected these changes.</p>
<p>Our users are not only those who use ArcGIS Pro, but also those who use ArcGIS Online or ArcGIS Enterprise, and even extend to those folks who consume data from ArcGIS Enterprise. Our software reaches far beyond those who work <em>just</em> in Pro. This is indicated by the development of ArcGIS Platform.</p>
<p>ArcGIS platform provides flexible data hosting in the cloud and ready to use location services. Data are easily accessible with Esri provided APIs and SDKs while location location services are just a REST request away.</p>
<p>R users are data consumers, providers, and analyzers. ArcGIS platform provides capabilities that are desirable for R users embedded in ArcGIS organizations such as data hosting, geocoding, routing, spatial analytics, and other data to enrich their analyses.</p>
<p>We haven’t yet given the R community the support they need to use our Platform services. The R community has already beat us to the punch. There have been a number of grassroots packages such as arcpullr, esri2sf, getarc, and getdata for accessing ArcGIS hosted data. And when it comes to routing and geocoding R users turn to other pre-built solutions.</p>
<p>It’s time we step up and improve our support for the R community. We’re going to do that by adding a new package to the R-ArcGIS Bridge for the first time in 8 years. The {arcgis} R package will be a new programmatic interface to pre-built data and location services.</p>
<p>{arcgis} will be a “meta-package” which is an R package that loads multiple related packages. This is a technique that is done for collections of packages that make up an “ecosystem” and is demonstrated by {tidyverse}, {tidymodels}, {easystats}, and for the large number of football nerds the <a href="https://nflverse.nflverse.com/">{nflverse}</a>. The meta-package approach is one that allows for logical partitioning of functionality into small easy to manage units.</p>
<p>For example, the tidyverse loads the packages dplyr, stringr, and lubridate (among others). dplyr is for data manipulation, string is for string manipulation, and lubridate is for data handling. One advantage of this is that users need not load <em>every</em> package if they do not want to. The meta-package acts as a convenience.</p>
<p>We will take a similar approach in which we build a “constellation of R packages” pertaining to ready made location-services that are available via REST API under the {arcgis} meta-package. The first of these packages will be {arcgisio} (name pending) focusing on hosted data whether it be ArcGIS Online, Portal, or living atlas. This package will provide the basic functionality for reading feature services and image layers while also providing write capabilities to feature services.</p>
<p>Today, the R-ArcGIS Bridge today contains only the R-ArcGIS Bridge</p>
<p><img src="images/paste-1.png" class="img-fluid" width="470"></p>
<p>We want to expand this to begin to support ArcGIS data and location services starting with data hosting</p>
<p><img src="images/paste-2.png" class="img-fluid" width="451"></p>
<p>Once the building blocks are in place, expanding {arcgis} will be relatively simple. We can continue improving the R-ArcGIS Bridge by adding to the arcgis meta-package constellation with other small packages for pre-built location services namely geocoding, routing, and enrichment to begin with.</p>
<p><img src="images/paste-3.png" class="img-fluid" width="595"></p>
<p>With this change the R-ArcGIS Bridge is no longer synonymous with {arcgisbinding} and ArcGIS Pro but our wider ecosystem. We can then begin to add other R packages to our ecosystem that are not strictly related to location services. For example, it would be in our best interest to make it very easy for R users to develop ArcGIS toolboxes similar to Python toolboxes. We can (and likely should) down the road build a package to assist in this.</p>
<p><img src="images/paste-4.png" class="img-fluid"></p>
<p><a href="https://www.esri.com/about/newsroom/arcuser/10-takeaways-from-the-2015-esri-user-conference/" class="uri">https://www.esri.com/about/newsroom/arcuser/10-takeaways-from-the-2015-esri-user-conference/</a></p>
<p><a href="https://www.esri.com/about/newsroom/arcuser/bringing-the-r-and-arcgis-communities-together/" class="uri">https://www.esri.com/about/newsroom/arcuser/bringing-the-r-and-arcgis-communities-together/</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>